# Results {#results}

In this chapter I present the uncertainty index that I proposed in [Non-Asset-Market Uncertainty Index]. Then, I compare it with the uncertainty indices from which it comes in [Correlation with Other Uncertainty indices]. After that, I evaluate the relationship between the new index and some real and financial variables in [Estimates on the Impact of Non-Asset-Market Uncertainty Shocks]. In the next stage, I shows how me proposal forecast better that alternative indices in [Forecasting]. Finally, I perform several robustness exercises in [Robustness].

## Non-Asset-Market Uncertainty Index {#non-asset-market-uncertainty-index}

```{r Import_Uncertainty}
source(here("index", "R", "Import-Uncertainty.R"))
```

```{r Import_USA_Data}
source(here("index", "R", "Import-USA-Data.R"))
```

```{r uncertainty_indices, message = FALSE}
uncertainty_indices <- list(
  economic_policy_uncertainty,
  monetary_policy_uncertainty_BBD,
  monetary_policy_uncertainty_HRS,
  geopolitical_risk_index,
  macro_uncertainty_JLN,
  real_uncertainty_JLN,
  financial_uncertainty_JLN
) %>% 
  reduce(inner_join)
```

```{r dynamic_factors, include = FALSE}
dynamic_factors <- dfm(
  uncertainty_indices[-1] %>% 
    mutate_all(~ scale(.)),
  , r = 1
  , q = 1
  , p = 1
)

write_rds(
  dynamic_factors, 
  here("index", "Data", "Output", "dynamic_factors.rds")
)

DFM_base <- tibble(
  Date = uncertainty_indices[["Date"]],
  PCA = dynamic_factors[["pca"]][, 1],
  `Two-step` = dynamic_factors[["twostep"]][, 1],
  QML = dynamic_factors[["qml"]][, 1],
  NAM = (QML - max(QML)) / (QML[1] - max(QML)) * 100
)
```

```{r DescribeIndex}
DescribeIndex <- function(x) {
  m <- mean(x)
  n <- length(x)
  s <- sd(x)
  skew <- sum((x - m)^3 / s^3) / n
  kurt <- sum((x - m)^4 / s^4) / n - 3
  AR <- lm(x ~ dplyr::lag(x))[["coefficients"]][2]
  HL <- log(0.5) / log(abs(AR))
  c(skew, kurt, AR, HL)
}
```

```{r QLR, include = FALSE}
NAM_ts <- ts(DFM_base[["NAM"]], start = c(1985, 1), frequency = 12)

NAM_data <- ts.intersect(NAM_ts, NAM_ts_1 = stats::lag(NAM_ts, k = -1))

QLR <- Fstats(NAM_ts ~ NAM_ts_1, data = NAM_data)

sctest(QLR)
```

```{r date_QLR, include = FALSE}
date_QLR <- breakpoints(NAM_ts ~ NAM_ts_1, data = NAM_data, h = 0.15)
  
coef(date_QLR, breaks = 1)
```

```{r Residuals_break, eval = FALSE}
Residuals_break <- DFM_base %>% 
  mutate(Break = ifelse(Date > ymd("2008-11-30"), 1, 0)) %>% 
  lm(NAM ~ Break, data = .) %>% 
  residuals()

DFM_base %<>% mutate(NAM = Residuals_break)
```

```{r csv}
write_csv(
  DFM_base %>% select(Date, NAM), 
  here("index", "Data", "Output", "Non-Asset-Market.csv")
)
```

I estimate the non-asset-market uncertainty index following the quasi-maximum likelihood estimator of @dozetal:2012 as described in [Dynamic factor model], although alternative estimators are tested in [Robustness]. Moreover, I use one dynamic factor, one static factor and one lag in the specification of the model because I am looking for one single summary index that captures the common comovements of uncertainty, hence, one dynamic and static factor seems appropriate. This binds the lag order to one as the lag order can not be greater that the ratio between the number of static factors and the number of dynamic factors---$p \le \frac{r}{q}$ [@kililutk:2017].

Although the goal is construct one economic index from the underlying series, it is worthy show all factors and its behavior. Each factor is associated with an eigenvalue of the correlation matrix of the the raw data. The first factor is associated with the largest eigenvalue, the second factor with the second-largest eigenvalue, and so on. A *scree plot* displays the marginal contribution---the average additional explanatory value of the kth factor---of the kth principal component to the average $R^{2}$ of the $N$ regressions of $X_{t}$ against the first k principal components. Essentially, the scree plot shows the ordered eigenvalues of $\hat{\sum}_{X}$ normalized by the sum of eigenvalues. The figure \@ref(fig:scree-plot) displays the scree plot where only the first factor is significant. Likewise, the plot shows a bend and only the first factor is above this sharp break (which suggest one factor following the scree test of @cattel:1966). In summary, a single component is appropriate for summarizing this dataset.

```{r scree_plot_values, include = FALSE}
scree_plot <- fa.parallel(
  uncertainty_indices[-1] %>% 
    mutate_all(~ scale(.)),
  fa = "pc",
  n.iter = 100,
  plot = FALSE 
)
```

(ref:scree-plot) **Scree Plot for Uncertainty Dataset**: The Figure shows a scree plot with the variance explained by each factor. The percentage explained taper off after the first factor---which is fill in black.

```{r scree-plot, fig.cap = "(ref:scree-plot)", fig.scap = "Scree Plot for Uncertainty Dataset"}
tibble(
  Component_Number = factor(1:length(uncertainty_indices[-1])), 
  Real = scree_plot[["pc.values"]] / length(uncertainty_indices[-1]), 
  Parallel = c("chosen", rep("others", length(uncertainty_indices[-1]) - 1))
) %>% 
  ggplot(aes(Component_Number, Real, fill = Parallel)) +
    geom_col() +
    scale_fill_viridis_d(option = "inferno") +
    labs(
      caption = "Source: Own calculations",
      x = "Factor number (principal component number)",
      y = "Fraction of total variance of the series explained"
    ) +
    theme(legend.position = "none")
```

(ref:non-asset-market-uncertainty-index) **Non-Asset-Market Uncertainty Index**: The Figure shows the non-asset-market uncertainty index from January 1985 to July 2017. Grey areas correspond to NBER recession dates (peak-to-trough), including the peaks and troughs. The horizontal line corresponds to the 95 percentile of the empirical distribution of the index. The original measure is scaled to start at 100.

```{r non-asset-market-uncertainty-index, fig.cap = "(ref:non-asset-market-uncertainty-index)", fig.scap = "Non-Asset-Market Uncertainty Index"}
DFM_base %>% 
  ggplot(aes(Date, NAM)) + 
    geom_cycle(fill = "grey50") +
    geom_hline(yintercept = quantile(DFM_base[["NAM"]], 0.95), size = 0.125) +
    geom_line() +
    #ggrepel::geom_label_repel() +
    scale_x_date(date_breaks = "3 year", date_labels = "%Y") +
    scale_y_continuous(limits = c(-100, 600)) +
    labs(
      caption = "Source: Own calculations",
      x = "",
      y = ""
    )
```

```{r VAR_data, message = FALSE}
VAR_data <- USA_data %>% 
  inner_join(uncertainty_indices) %>% 
  inner_join(DFM_base)
```

```{r IP, message = FALSE}
IP <- tq_get("INDPRO", get = "economic.data", from = "1972-01-01") %>% 
  transmute(
    Date = seq(ymd(19720201), ymd(20191101), by = "1 month") - 1,
    growth_production_all = 12 * 100 * log(price / lag(price))
  ) %>% 
  drop_na() %>% 
  mutate(moving_growth_production_all = SMA(growth_production_all, n = 12)) %>% 
  drop_na()

VAR_data %<>% inner_join(IP)
```

In the Figure \@ref(fig:non-asset-market-uncertainty-index) is presented the non-asset-market index together with the recession dates in the United States as indicated by the National Bureau of Economic Research (NBER) on its website <https://www.nber.org/cycles.html>. Also, the 95th percentile of the series is presented as solid horizontal bar. The index peaks coincide with well known episodes of uncertainty in the economy as the Black Monday in October 1987, the bursting of the dot-com bubble and the Great Recession 2007--2009, although only the last has considerable impact.

The index is clearly countercyclical, the cross-correlation with industrial production growth^[The industrial production growth is calculated as the 12-month moving average of monthly growth rates (in annualized percentage).] is $-0.69$. In the same period, the cross-correlation for the macroeconomic uncertainty index from @juraetal:2015 is `r comma(cor(VAR_data[["moving_growth_production_all"]], VAR_data[["MU_JLN_h1"]]))`. The latter shows that the new index has less pronounced peaks around the recession dates of the economy, which is more appealing to a continually level of uncertainty in the economy.

In Table \@ref(tab:summary-table) I report descriptive statistics for the non-asset-market uncertainty index. The skewness, kurtosis, persistence and half-life for the full sample and for two sub-samples are presented (January 1985 to July 2007 and August 2007 to August 2017). This break date was chosen after testing for a break at an unknown date in the autoregressive model of the shocks persistence---AR(1) with drift. The basic idea is to calculate an $F$ statistic---often called Chow statistic, named for its inventor, Gregory Chow [-@chow:1960]---for each conceivable breakpoint in the interval $\tau_{0} = 0.15T$ and $\tau_{1} = 0.85T$, where $T$ is the total number of observations, and reject the null hypothesis of structural stability if the largest of the resulting $F$ statistics exceeds a certain critical value^[That is to say, an $F$ statistic is computed for each potential breakpoint between 1989:M11 and 2012:M9 testing the hypothesis that the coefficients are constant against the alternative that they have different values before and after the breakpoint, omitting the leading and trailing 15 \% of observations.] [@andrews:2003]. This modified Chow test is variously called the Quand Likelihood Ratio (QLR) statistic [@quandt:1960]^[See @hansen:2001 for additional discussion of estimation and testing in the presence of discrete breaks. Also, see @perron:2006 for a general survey.]. Given that there is evidence of one structural change in the model is necessary dating that structural change. Bai and Perron [-@baiperr:1998;-@baiperr:2003]  established a general methodology for estimating breakpoints and their associated confidence intervals in OLS regression. Henceforth, the two periods are choose following this methodology.

The summary statistics in Table  \@ref(tab:summary-table) for the full period are misleading. For the first period of the sample the persistence is less that for the second period, so the time before a shock halve the distance to the stationary mean is smaller. Moreover, the distribution of the uncertainty index is different in location and shape for each period: the first part is slightly asymmetric and it has fewer outliers while the second part has more values above that below the mean and it has several values far from the mean. Nevertheless, the similarity between both periods is substantial but the shock for the Great Recession in 2007--2009. The last result can be though as evidence in line with a level of uncertainty less volatile and extreme across the economy, which is in concordance with the lower correlation founded in the last paragraph with a proxy for business cycle---industrial production.

The persistence of the non-asset-market uncertainty index in the second sample is greater, for example, than that of the macroeconomic uncertainty from @juraetal:2015: `r comma(DescribeIndex(DFM_base[DFM_base[["Date"]] >= "2007-08-31", ][["NAM"]])[4])` months versus `r comma(DescribeIndex(uncertainty_indices[["MU_JLN_h1"]])[4])` months. This shows that the level of uncertainty is continual in the sample.

```{r summary-table-raw}
summary_table_raw <- tibble(
  Statistic = c(
    "Skewness", "Excess kurtosis", "Persistence, AR(1)", "Half-life (months)"
  ),
  `1985:M1--2017:M7` = DescribeIndex(
    DFM_base[["NAM"]]
  ),
  `1985:M1--2007:M7` = DescribeIndex(
    DFM_base[DFM_base[["Date"]] <= "2007-07-31", ][["NAM"]]
  ),
  `2007:M8--2017:M7` = DescribeIndex(
    DFM_base[DFM_base[["Date"]] >= "2007-08-31", ][["NAM"]]
  )
)
```

(ref:summary-table) **Summary Statistics of Non-Asset-Market Uncertainty Index in Two Sub-Samples**: The table reports estimates of skewness, kurtosis, first-order autocorrelation coefficient and half-life of an aggregate uncertainty innovation.

```{r summary-table, results = "asis"}
kable(
  summary_table_raw
  , digits = 3,
  , align = c("l", "c", "c", "c")
  , caption = "(ref:summary-table)"
  , caption.short = "Summary Statistics of Non-Asset-Market Uncertainty Index in Two Sub-Samples"
  , booktabs = TRUE
) %>% 
  add_header_above(c("", "Sample period" = 3))
```

<!-- The second estimator used is the Two-Step developed by @dozetal:2011. This methods uses PCA estimates and runs them through Kalman filter. -->

<!-- The third estimator used is the Quasi-Maximum Likelihood by @dozetal:2012. Similar to two-step estimator, however Kalman filtering procedure is iterated until Expectation-Maximization (EM) algorithm converges. -->

## Correlation with Other Uncertainty Indices {#correlation-with-uncertainty-indices}

```{r corr_indices, message = FALSE, warning = FALSE}
corr_indices <- cor(
  uncertainty_indices %>%
    inner_join(DFM_base) %>% 
    select(-c(Date, PCA, `Two-step`, QML)) %>% 
    rename(
      `EPU (3C)` = EPU3C,
      `EPU (News)` = EPUNews,
      `MPU (AWN)` = MPU_BBD_AWN,
      `MPU (10)` = MPU_BBD_10,
      `MPU` = MPU_HRS,
      `MU (h = 1)` = MU_JLN_h1,
      `MU (h = 3)` = MU_JLN_h3,
      `MU (h = 12)` = MU_JLN_h12,
      `RU (h = 1)` = RU_JLN_h1,
      `RU (h = 3)` = RU_JLN_h3,
      `RU (h = 12)` = RU_JLN_h12,
      `FU (h = 1)` = FU_JLN_h1,
      `FU (h = 3)` = FU_JLN_h3,
      `FU (h = 12)` = FU_JLN_h12,
      `Non-Asset-Market` = NAM
    )
)
```

(ref:corr-plot) **Correlogram Between the Non-Asset-Market Uncertainty Index and Other Uncertainty Indices**: The figure shows the correlation matrix between the the non-asset-market uncertainty index and other indices. The variables are defined as: EPU (3C): economic policy uncertainty index from three underlying components, EPU (News): economic policy uncertainty index based on newspaper archives from Access World New's NewsBank service, MPU (AWN): monetary policy uncertainty from draws on hundreds of U.S. newspapers covered by Access World News, MPU (10): monetary policy uncertainty from draws on a balanced panel of 10 major national and regional U.S. newspapers, MPU: monetary policy uncertainty from draws on the Wall Street Journal, New York Times and Washington post, MU (h): macroeconomic uncertainty at h horizon, RU (h): real uncertainty at h horizon, FU (h): financial uncertainty at h horizon and Non-Asset-Market: the uncertainty index propose in this document.

```{r corr-plot, fig.asp = 0.85, fig.cap = "(ref:corr-plot)", fig.scap = "Correlogram Between the Non-Asset-Market Uncertainty Index and Other Uncertainty Indices"}
corrplot(
  corr_indices,
  method = "color", 
  col = viridis(20, option = "B"),
  diag = FALSE,
  order = "FPC", 
  tl.cex = 0.8,
  tl.col = "black",
  tl.offset = 1,
  tl.srt = 45,
  cl.cex = 0.8,
  cl.offset = 0.9,
  cl.lim = c(-0.1, 1),
  cl.length = 11, 
  cl.ratio = 0.2
)
```

To interpret the Figure \@ref(fig:corr-plot), the color in each cell represents a correlation between the two variables that meet at each cell. The magnitude and direction of the correlation is defined by the color spectrum in the legend of the plot. In general, the light color represents a positive correlation and the dark color represents a low or even negative correlation. Also, the rows and columns have been reordered (using principal components analysis, as explained in @friendly:2002 for correlograms) to cluster variables together that have similar correlation patterns. It is shown from the shaded cells that the non-asset-market uncertainty index is much more correlated with the econometrics measures of uncertainty and less with the newspaper-based measures of uncertainty.

## Estimates on the Impact of Non-Asset-Market Uncertainty Shocks {#estimates-on-the-impact-of-non-asset-market-uncertainty-shocks}

I explore the dynamic relationship between my uncertainty index and some variables from the United States' economy. For that purpose, I use a benchmark model well documented: the model proposed by @chrietal:2005---and used as a base in @chuletal:2017. First, the characterization of monetary policy is defined by:

\begin{equation}
    R_{t} = f(\Omega_{t}) + \epsilon_{t} (\#eq:R)
\end{equation}

Where, $R_ {t}$ is the effective federal funds rate---understood as the monetary policy instrument---, $f$ is a linear function, $\Omega_{t}$ is an information set and $\epsilon_{t}$ is the monetary policy shock, where it is assumed that $\epsilon_{t}$ is orthogonal to $\Omega_{t}$.

Considering $Y_{t}$ as the set of variables to which the dynamic effect of an uncertainty shock will be analyzed, there is:

\begin{equation}
    Y_{t} = 
    \begin{bmatrix}
      Y_{1t} & R_{t} & Y_{2t} & U_{t} (\#eq:variables)
    \end{bmatrix}_{T \times N}'
\end{equation}

The vector $Y_{1t}$ is composed of the variables whose values at the moment $t$ are contained in $\Omega_{t}$ and it is assumed that they do not respond simultaneously to a monetary policy shock: production, employment, consumption, inflation, new orders, wages and labor. The vector $Y_{2t}$ consists of the values at the moment $t$ of all the other variables in $\Omega_{t}$, which simultaneously respond to a monetary policy shock: stock market index and M2. In the last position, I place my uncertainty index $U_{t}$---as do @juraetal:2015, @bloom:2009, and @chuletal:2017^[See [Data] for a detailed description of the series used in this section as the transformations made to them.]. I estimate a VAR model with 12 fixed lags, as opposed to the four quarters used in @chrietal:2005 following the caveats of Leeb \& Pötscher [-@leebpots:2005;-@leebpots:2006], as discussed in [Lag order]. I recover the structural innovations by means of a Cholesky factorization of the variance-covariance matrix. Since depending on whether the variables react or not to other variables contemporaneously, the Cholesky decomposition implies a certain ordering, the estimation order from more exogenous to more endogenous is the same as of the Equation \@ref(eq:variables).

The VAR model with constant term ignored can be written as follows:

\begin{equation}
  Y_{t} = A_{1}Y_{t - 1} + \cdots + A_{12}Y_{t - 12} + C \eta_{t}
\end{equation}

where $C$ is a $11 \times 11$ lower triangular matrix with diagonal terms equal to unity, and $\eta_{t}$ is a eleven-dimensional vector of zero-mean, serially uncorrelated shocks with a diagonal variance-covariance matrix. I estimate the parameters $A_{i} ~ \text{with} ~ i=1, \ldots, ~ 12$, $C$, and the variances of the elements of $\eta_{t}$ using standard least-squares methods. Using these estimates, I compute the dynamic path of the variables following a one shock in $U_{t}$ with initial conditions set to zero. This paths corresponds to the coefficients in the impulse response functions, which are displayed in Figure \@ref(fig:irf-baseline-plot).

```{r chosen_variables}
chosen_variables <- c(
  "Production_all_log_cycle",
  "Employment_all_lin_cycle",
  "Consumption_log_cycle",
  "Inflation_cycle",
  "NewOrders_log_cycle",
  "Wages_all_log_cycle",
  "Labor_all_lin_cycle",
  "FederalFundsRate_lin_cycle",
  "StockMarketIndex_log_cycle",
  "M2_cca_cycle",
  "NAM"
)
```

```{r VAR_baseline_lag}
VAR_baseline_lag <- VARselect(
  VAR_data %>% select(!!!chosen_variables),
  lag.max = 12
)
```

```{r VAR_baseline}
VAR_baseline <- VAR(
  VAR_data %>% select(!!!chosen_variables),
  p = 12
)
```

```{r irf_baseline, warning = FALSE}
irf_baseline <- irf(
  VAR_baseline,
  impulse = "NAM",
  n.ahead = 60,
  runs = 100,
  ci = 0.86
)
```

```{r irf_baseline_matrix}
matrix_response <- as_tibble(irf_baseline[["irf"]][["NAM"]]) %>%
  mutate(Months = row_number()) %>%
  gather(-Months, key = "Variable", value = "Response")

matrix_lower <- as_tibble(irf_baseline[["Lower"]][["NAM"]]) %>%
  mutate(Months = row_number()) %>%
  gather(-Months, key = "Variable", value = "Lower")

matrix_upper <- as_tibble(irf_baseline[["Upper"]][["NAM"]]) %>%
  mutate(Months = row_number()) %>%
  gather(-Months, key = "Variable", value = "Upper")

matrix_irf <- list(matrix_response, matrix_lower, matrix_upper) %>%
  reduce(inner_join, by  = c("Variable", "Months")) %>%
  select(Variable, Months, Response, Lower, Upper) %>%
  arrange(Variable, Months) %>%
  mutate(
    Variable = factor(Variable),
    Variable = fct_recode(
      Variable,
      "Production" = "Production_all_log_cycle",
      "Employment" = "Employment_all_lin_cycle",
      "New Orders" = "NewOrders_log_cycle",
      "Consumption" = "Consumption_log_cycle",
      "Federal Funds Rate" = "FederalFundsRate_lin_cycle",
      "Stock Market Index" = "StockMarketIndex_log_cycle"
    )
  )
```

(ref:irf-baseline-plot) **Economic Dynamics Under Uncertainty in the 11-Variable VAR**: The figure shows the reaction of the variables to an unexpected increment of non-asset-market uncertainty (model with 12 fixed lags following Leeb \& Pötscher [-@leebpots:2005;-@leebpots:2006], as explained in [Lag order]), based on 1000 replications. The axes are in percentages but the federal funds rate is in basic points and employment is in number of employees. The estimation period runs from January 1985 to July 2017. Confidence bands (86 \%) are calculated using bootstrapping techniques as explained in @efrotibs:1993.

```{r irf-baseline-plot, fig.asp = 1.4, fig.cap = "(ref:irf-baseline-plot)", fig.scap = "Economic Dynamics Under Uncertainty in the 11-Variable VAR"}
matrix_irf %>%
  filter(Variable %in% c(
    "Production",
    "Employment",
    "New Orders",
    "Consumption",
    "Federal Funds Rate",
    "Stock Market Index"
  )) %>%
  ggplot(aes(Months, Response)) +
    geom_hline(aes(yintercept = 0), size = 0.125) +
    geom_ribbon(
      aes(ymin = Lower, ymax = Upper), 
      fill = "steelblue", 
      alpha = 0.125
    ) +
    geom_line(colour = "steelblue", linetype = "dashed") +
    scale_x_continuous(breaks = seq(0, 60, by = 10)) +
    facet_wrap(
      ~ Variable,
      nrow = 3,
      scales = "free"
    ) +
    labs(
      caption = "Source: Own calculations",
      x = "Months after the shock",
      y = "Impact"
    ) +
    theme(strip.text = element_text(size = rel(1.25)))
```

Production reacts negatively to an uncertainty shock and the persistence last until the second year. Likewise, employment decreases following a uncertainty shock and the impact persists for the same time that production (two years). In contrast, new orders reacts negatively faster and last for only one year after which its becomes zero. Consumption reacts slowly to the uncertainty shock, this decreases after one year and maintain its behavior for two years and a half (that is, six months more than production, employment and new orders). The stock market index is severely affected and his persistence last for the same period that the variables discussed so far. Although, the series does not stabilize at a lower level as reported in @chuletal:2017. In addition, the federal funds rate also seems sensitive to an uncertainty shock. Specifically, the Federal reserve reduce the interest rate---which is significant for the first year---that shows that the reduction in the stock market index is due to uncertainty and not to movements in the interest rate. Finally, I don't find any evidence of the *rebound* effect evidenced in @bloom:2009 for production neither the *rebound* effect proposed in @chuletal:2017 for New Orders.

The Figure \@ref(fig:fevd-plot) shows the forecast error variance decomposition (FEVD) which allows to analyze the contribution of each variable to the $h$-step forecast error variance of all other variables. Accordingly, the forecast error of the production series is explained by uncertainty six months after the innovation in 10 \%, twelve months after in 25 \%  and twenty-four months after in 30 \%. For employment, uncertainty accounts for 10 \% twelve months after the original structural innovation and 20 \% two years later. For new orders, the uncertainty accounts for 15 \% of the variance six months on and then stabilize in 10 \%. For consumption, the uncertainty accounts for less that 5 \% in the first twelve months but after for 15 \% of the variance. For the financial prices---stock market index---, the uncertainty accounts for the same amount as consumption, i.e., starts in 5 \% and then its stabilizes in 15 \%. Finally, the forecast error of federal funds rate is explained by uncertainty between the 5 \% and 10 \%. These results confirm the importance of uncertainty as a driver of the economy's dynamics.

One important question to resolver is if monetary policy interventions have effect on uncertainty. The Figure \@ref(fig:fevd-plot) shows the reaction of uncertainty to an unexpected loosening of monetary policy; it can be see that there not a significant effect. That is to say, an expansionary monetary policy does not have sizable impact on uncertainty. In the same way, the forecast error of the uncertainty series is minimally explained by an uncertainty shock (see Figure \@ref(fig:R-fevd-plot)). These findings are contrary to the documented in @bekaetal:2013 and @chuletal:2017, which reports significant effects, and add to the research field by exploring the relationship between policy intervention and uncertainty.

```{r fevd, warning = FALSE, message = FALSE}
fevd_baseline <- fevd(VAR_baseline, 60)
```

```{r fevd_tibble}
fevd_tibble <- do.call("rbind", fevd_baseline)
fevd_tibble %<>% 
  as_tibble() %>% 
  mutate(
  Id = c(
    rep("Production", 60),
    rep("Employment", 60),
    rep("Consumption", 60),
    rep("Inflation", 60),
    rep("New Orders", 60),
    rep("Wages", 60),
    rep("Labor", 60),
    rep("Federal Funds Rate", 60),
    rep("Stock Market Index", 60),
    rep("Growth Rate of M2", 60),
    rep("Non-Asset-Market Uncertainty", 60)
  )
) %>% 
  filter(Id %in% c(
    "Production",
    "Employment",
    "New Orders",
    "Consumption",
    "Federal Funds Rate",
    "Stock Market Index"
  )) %>% 
  rename(
    Production = Production_all_log_cycle,
    Employment = Employment_all_lin_cycle,
    Consumption = Consumption_log_cycle,
    Inflation = Inflation_cycle,
    `New Orders` = NewOrders_log_cycle,
    Wages = Wages_all_log_cycle,
    Labor = Labor_all_lin_cycle,
    `Federal Funds Rate` = FederalFundsRate_lin_cycle,
    `Stock Market Index` = StockMarketIndex_log_cycle,
    `M2` = M2_cca_cycle,
    `Non-Asset-Market Uncertainty` = NAM
  ) %>% 
  group_by(Id) %>% 
  mutate(N = row_number()) %>% 
  gather(
    Production:`Non-Asset-Market Uncertainty`, 
    key = "Variable", 
    value = "Percentage"
  ) %>% 
  mutate(Variable = factor(Variable, levels = unique(Variable))) %>%
  arrange(N)
```

(ref:fevd-plot) **Forecast Error Variance Decomposition in the 11-Variable VAR**: The figure shows the percentage of variance of the $h$-step-ahead forecast error due to a shocks of each variable, for $h = 1, \ldots, 60$.

```{r fevd-plot, fig.asp = 1.7, fig.cap = "(ref:fevd-plot)", fig.scap = "Forecast Error Variance Decomposition in the 11-Variable VAR"}
fevd_tibble %>%
  ggplot(aes(N, Percentage)) +
    geom_area(aes(fill = Variable), colour = "black", size = 0.20) +
    scale_y_continuous(breaks = seq(0, 1, by = 0.20), labels = percent) +
    scale_x_continuous(breaks = c(1, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60)) +
    scale_fill_viridis_d(option = "inferno") +
    facet_wrap(
      ~ Id,
      nrow = 3,
      scales = "free"
    ) +
    labs(
      caption = "Source: Own calculations",
      x = "Horizon",
      y = "",
      fill = ""
    ) +
    theme(
      legend.position = "bottom", 
      strip.text = element_text(size = rel(1.25))
    ) +
    guides(fill = guide_legend(nrow = 4))
```

<!-- # ```{r Granger} -->
<!-- # Granger <- function(Cause) { -->
<!-- #   causality(VAR_baseline, cause = Cause)[["Granger"]][["p.value"]] -->
<!-- # } -->
<!-- # ``` -->
<!-- # -->
<!-- # ```{r Names_VAR} -->
<!-- # Names_VAR <-   c( -->
<!-- #   "Production", -->
<!-- #   "Employment", -->
<!-- #   "Consumption", -->
<!-- #   "Inflation", -->
<!-- #   "New Orders", -->
<!-- #   "Wages", -->
<!-- #   "Labor", -->
<!-- #   "Federal Funds rate", -->
<!-- #   "Stock market index", -->
<!-- #   "M2", -->
<!-- #   "Non-Asset-Market Uncertainty" -->
<!-- # ) -->
<!-- # ``` -->
<!-- # -->
<!-- # ```{r p_values_granger} -->
<!-- # p_values_granger <- map_dbl(chosen_variables, Granger) -->
<!-- # ``` -->
<!-- # -->
<!-- # (ref:Granger-table) **Granger-Causality Tests**: The entries show the $p$-values for F-tests that lags of the variable in the row labeled *Regressor* do not enter the reduced form equation for all remaining variables. -->
<!-- # -->
<!-- # ```{r Granger-table, results = "asis"} -->
<!-- # knitr::kable( -->
<!-- #   tibble( -->
<!-- #     Regressor = Names_VAR, -->
<!-- #     `p-values` = p_values_granger -->
<!-- #   ) -->
<!-- #   , digits = 2, -->
<!-- #   , align = c("l", "c"), -->
<!-- #   , caption = "(ref:Granger-table)" -->
<!-- #   , caption.short = "Granger-Causality Tests", -->
<!-- #   , booktabs = TRUE -->
<!-- #   , linesep = "" -->
<!-- # ) -->
<!-- # ``` -->

```{r irf_R}
irf_R <- irf(
  VAR_baseline,
  impulse = "FederalFundsRate_lin_cycle",
  response = "NAM",
  n.ahead = 60,
  runs = 100,
  ci = 0.86
)
```

```{r irf_R_matrix}
irf_R_matrix <- tibble(
  Months = 0:60,
  Response = as.vector(irf_R[["irf"]][["FederalFundsRate_lin_cycle"]]),
  R_lower = as.vector(irf_R[["Lower"]][["FederalFundsRate_lin_cycle"]]),
  R_upper = as.vector(irf_R[["Upper"]][["FederalFundsRate_lin_cycle"]]),
)
```

```{r}
fevd_NAM <- as_tibble(fevd_baseline[["NAM"]])

fevd_NAM %<>% 
  rename(
    Production = Production_all_log_cycle,
    Employment = Employment_all_lin_cycle,
    Consumption = Consumption_log_cycle,
    Inflation = Inflation_cycle,
    `New Orders` = NewOrders_log_cycle,
    Wages = Wages_all_log_cycle,
    Labor = Labor_all_lin_cycle,
    `Federal Funds Rate` = FederalFundsRate_lin_cycle,
    `Stock Market Index` = StockMarketIndex_log_cycle,
    `M2` = M2_cca_cycle,
    `Non-Asset-Market Uncertainty` = NAM
  ) %>% 
  mutate(N = row_number()) %>% 
  gather(
    Production:`Non-Asset-Market Uncertainty`, 
    key = "Variable", 
    value = "Percentage"
  ) %>% 
  mutate(Variable = factor(Variable, levels = unique(Variable))) %>%
  arrange(N)
```

(ref:R-plot) **Dynamics of Policy Intervention and Uncertainty in the 11-Variable VAR**: The figure shows the reaction of uncertainty to an unexpected loosening of monetary policy (model with 12 fixed lags following Leeb \& Pötscher [-@leebpots:2005;-@leebpots:2006], as explained in [Lag order]), based on 1000 replications. The axis is in units. The estimation period runs from January 1985 to July 2017. Confidence bands (86 \%) are calculated using bootstrapping techniques as explained in @efrotibs:1993.

```{r R-plot, fig.cap = "(ref:R-plot)", fig.scap = "Dynamics of Policy Intervention and Uncertainty in the 11-Variable VAR"}
irf_R_matrix %>%
  ggplot(aes(Months, Response)) +
    geom_hline(aes(yintercept = 0), size = 0.125) +
    geom_ribbon(
      aes(ymin = R_lower, ymax = R_upper),
      fill = "steelblue",
      alpha = 0.125
    ) +
    geom_line(colour = "steelblue", linetype = "dashed") +
    scale_x_continuous(breaks = seq(0, 60, by = 5)) +
    labs(
      caption = "Source: Own calculations",
      x = "Months after the shock",
      y = "Impact"
    ) 
```

(ref:R-fevd-plot) **Forecast Error Variance Decomposition for Uncertainty in the 11-Variable VAR**: The figure shows the fractions of the forecast error variance due monetary policy innovations. The estimation period runs from January 1985 to July 2017. 

```{r R-fevd-plot, fig.cap = "(ref:R-fevd-plot)", fig.scap = "Forecast Error Variance Decomposition for Uncertainty in the 11-Variable VAR"}

fevd_NAM %>%
  ggplot(aes(N, Percentage)) +
    geom_area(aes(fill = Variable), colour = "black", size = 0.20) +
    scale_y_continuous(breaks = seq(0, 1, by = 0.20), labels = percent) +
    scale_x_continuous(breaks = c(1, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60)) +
    scale_fill_viridis_d(option = "inferno") +
    labs(
      caption = "Source: Own calculations",
      x = "Horizon",
      y = "",
      fill = ""
    )
```

## Forecasting {#forecasting}

The forecasting capabilities of the VAR model are evaluated with different uncertainty indices through multistep-ahead forecasts---computed by iterating forward the reduced form VAR---in Table \@ref(tab:rmsfe-non-asset-market). The core idea, following @stocwats:2001, of an iterated forecast is that a VAR model is used to make a forecast one period ahead ($T + 1$) using data through period $T$. Then the model is used to make a forecast for date $T + 2$, given the data through date $T$, where the forecasted value for date $T + 1$ is treated as data for the purpose of making the forecast for period $T + 2$. Therefore, the one-step ahead forecast is used as an intermediate step to make the two-step ahead forecast. This process is iterated until the forecast is made for the desired forecast horizon $h$. In other words, to compute multistep iterated VAR forecasts $h$ steps ahead, it is necessary to compute forecasts of all variables for all intervening periods between $T$ and $T + h$. Since the ultimate test of a forecasting model is its out-of-sample performance, Table \@ref(tab:rmsfe-non-asset-market) focuses on pseudo out-of-sample forecasts over the period from 2014:M4 to 2017:M7---that is the 10 \% of the sample. Likewise, it examines forecast horizons of three months, six months, nine months and twelve months: $h = 3, 6, 9, 12$. 

Table \@ref(tab:rmsfe-non-asset-market) shows the root mean square forecast error of the forecasting model for several uncertainty indices. The mean squared forecast error is computed as the average squared value of the forecast error over the 2014--2017 out-of-sample period, and the resulting square root is the mean squared forecast error reported in the table. For instance, Table \@ref(tab:rmsfe-non-asset-market) indicates that the VAR model with the non-asset market index as last variable improves upon the VAR models with the economic policy uncertainty or macroeconomic uncertainty in replace. Specifically, the forecast model with the non-asset-market uncertainty index has lower error for employment, labor and stock market index over the two remaining models and for production, wages and federal funds rate is the second best.

```{r EndOfSample}
# End of sample dates
EndOfSample <- VAR_data %>%
  tail(nrow(.) - quantile(1:nrow(.), 0.90) + 1) %>%
  pull(Date)
```

```{r forecast_horizont}
forecast_horizont <- list(3, 6, 12, 24)
```

```{r indices}
indices <- c("NAM", "EPU3C", "MU_JLN_h1")
```

```{r Forecast_Error}
Forecast_Error <- function(end_date, h, index) {
  # Model variables
  model_variables <- c(
    "Production_NAICS_log_cycle",
    "Employment_manu_lin_cycle",
    "Inflation_urban_cycle",
    "Wages_manu_log_cycle",
    "Labor_manu_lin_cycle",
    "FederalFundsRate_lin_cycle",
    "StockMarketIndex_log_cycle"
  )
  
  variables <- c(model_variables, index)  
  
  # Estimate VAR model
  VAR_model <- VAR(
    VAR_data %>%
      filter(Date <= end_date) %>%
      select(!!!variables), 
    p = 12
  )

  # Sample data for n-period ahead forecast
  raw_data <- VAR_data %>%
    filter(
      between(
        Date,
        ceiling_date(end_date %m+% months(1), unit = "month") - days(1),
        ceiling_date(end_date %m+% months(h), unit = "month") - days(1)
      )
    ) %>%
    select(!!!variables)

  # Compute forecast
  raw_predictions <- bind_rows(
    predict(VAR_model, n.ahead = h)[["fcst"]],
    .id = "column_label"
  ) %>%
    head(h) %>%
    select(-column_label)

  # Compute pseudo-out-of-sample forecast errors
  raw_data - raw_predictions
}
```

```{r rmsfe}
rmsfe <- function(h, index) {
  rmsfe_raw <- map_dfr(
    EndOfSample %>% head(-h),
    Forecast_Error,
    h = h,
    index = index
  ) %>%
  summarise_all(~sqrt(mean(.)^2))

  rmsfe_raw
}
```

```{r rmsfe_indices}
rmsfe_indices <- function(index) {
  rmsfe_tibble <- map_dfr(
    forecast_horizont,
    rmsfe,
    index = index
  )
  
  rmsfe_tibble
}
```

```{r rmsfe_table}
rmsfe_table <- map_dfr(
  indices,
  rmsfe_indices, 
  .id = "label"
)

rmsfe_table %<>% 
  select(-(NAM:MU_JLN_h1)) %>% 
  select(-label) %>% 
  rename(
    Production = Production_NAICS_log_cycle,
    Employment = Employment_manu_lin_cycle,
    Labor = Labor_manu_lin_cycle,
    Inflation = Inflation_urban_cycle,
    Wages = Wages_manu_log_cycle,
    `Federal Funds Rate` = FederalFundsRate_lin_cycle,
    `Stock Market Index` = StockMarketIndex_log_cycle,
  ) %>%
  mutate(
    `Forecast Horizont` = factor(rep(str_c(forecast_horizont, " months"), 3))
  ) %>% 
  select(`Forecast Horizont`, everything())
```

(ref:rmsfe-non-asset-market) **Root Mean Squared Errors of Simulated Out-Of-Sample Forecasts, 2014:M4--2017:M7**: Entries are the root mean squared error of forecasts computed recursively for vector autoregressions with different uncertainty index (models with 12 fixed lags following Leeb \& Pötscher [-@leebpots:2005;-@leebpots:2006], as explained in [Lag order]). Each model was estimated using data from 1985:M1 through the beginning of the forecast period.

```{r rmsfe-non-asset-market, results = "asis"}
kable(
  rmsfe_table
  , digits = 2,
  , align = c(rep("c", 8))
  , caption = "(ref:rmsfe-non-asset-market)"
  , caption.short = "Root Mean Squared Errors of Simulated Out-Of-Sample Forecasts"
  , booktabs = TRUE
  , linesep = ""
) %>% 
  kable_styling(full_width = TRUE) %>% 
  pack_rows(index = c(
    "Non-Asset-Market Uncertainty Index" = 4, 
    "Economic Policy Uncertainty Index" = 4, 
    "Macroeconomic Uncertainty Index" = 4)
  , latex_gap_space = "2em"
  ) %>% 
  landscape() 
```

## Robustness {#robustness}

I perform several robustness exercises varying the econometric methodology employed to create the non-asset-market uncertainty index. I estimate the uncertainty index using PCA [@stocwats:2002] and PCA estimates runs through Kalman ﬁlter---two-step [@dozetal:2011]---instead of quasi-maximum likelihood [@dozetal:2012]. The results are summarized in Figure \@ref(fig:robustness-methods). In general, the uncertainty index behaves in a very similar fashion, regardless of the factor methodology used to summarize the components of the series.

In the same way, I employ different variable sets and orderings in the VAR estimated in [Estimates on the Impact of Non-Asset-Market Uncertainty Shocks]. First, I change the sector of the variables to the manufacturing sector with eight variables following @bloom:2009. The variables in the estimation order are production in manufacturing, employment in manufacturing, labor in manufacturing, inflation (based on all urban consumers), wages in manufacturing, federal funds rate, stock-market index and non-asset-market uncertainty^[See [Data] for a detailed description of the series used in this section as the transformations made to them.]. The ordering is based on the assumptions that shocks instantaneously influence the stock market, then prices (wages, inflation, and interest rates), and finally quantities (labor, employment, and output). All variables are Hamilton detrended with a look-ahead period of two years ($h = 24$), as explained in [Detrend].

Figure \@ref(fig:production-medium) plots the impulse response function of industrial production in manufacturing (the dashed line) to a non-asset-market uncertainty shock. The variable displays a fall of around 0.85 \% within 15 months. The confidence bands (shaded area) are plotted around this, highlighting that this drop is statistically significant. For comparison to a first-moment shock, the response to a impulse to the federal funds rate is also plotted (dotted line) displaying a minor drop over the subsequent 2 years^[The response to a fall the stock-market (not plotted) is similar in size and magnitude to the response to a rise in the federal funds rate.]. Figure \@ref(fig:employment-medium) repeats the same exercise for employment, displaying a similar drop in activity. These findings are evidence that the overshoot observed by @bloom:2009 is sensitive to whether the data are HP filtered---as claims @juraetal:2015---because this document uses the Hamilton filter but the same data.

In Figure \@ref(fig:robustness), the VAR results are show to be robust to a variety of alternative variables sets and orderings. The VAR is reestimated using a simple trivariate VAR (production in manufacturing, employment in manufacturing and non-asset-market uncertainty only) which also display a drop (dashed line). The "quadvariate" VAR (production in manufacturing, employment in manufacturing, stock-market index and non-asset-market uncertainty only) also displays a similar drop (solid line), as does the quadvariate VAR with the variable ordering reversed (dotted line). Therefore, the response of production to an uncertainty shock appears robust to both the basic selection and the ordering of variables.

Henceforth, Figures \@ref(fig:robustness-methods), \@ref(fig:production-medium), \@ref(fig:employment-medium) and \@ref(fig:robustness) confirm the robustness of the DFM to the methodology used and of VAR results to a range of alternative approaches over variable ordering and variable inclusion.

(ref:robustness-methods) **Robustness to Estimation Method**: The figure shows the comparison between the non-asset-market uncertainty index using quasi-maximum likelihood [@dozetal:2012], principal components [@stocwats:2002] and two-step [@dozetal:2011]. All the indices have been standardized to make proper comparisons.

```{r robustness-methods, fig.cap = "(ref:robustness-methods)", fig.scap = "Robustness to Estimation Method"}
DFM_base %>% 
  mutate(
    PCA = (PCA - max(PCA)) / (PCA[1] - max(PCA)) * 100,
    `Two-step` = (
      (`Two-step` - max(`Two-step`)) / (`Two-step`[1] - max(`Two-step`)) * 100
    ),
    QML = (QML - max(QML)) / (QML[1] - max(QML)) * 100
  ) %>% 
  gather(PCA:QML, key = "Method", value = "Index") %>% 
  ggplot(aes(Date, Index)) +
    geom_cycle(fill = "grey50") +
    geom_line(aes(colour = Method)) +
    scale_x_date(date_breaks = "3 year", date_labels = "%Y") +
    scale_y_continuous(limits = c(-100, 600)) +
    scale_colour_viridis_d(option = "inferno") +
    labs(
      caption = "Source: Own calculations",
      x = "",
      y = ""
    )
```

```{r chosen_variables_eight}
chosen_variables_eight <- c(
  "Production_NAICS_log_cycle",
  "Employment_manu_lin_cycle",
  "Inflation_urban_cycle",
  "Wages_manu_log_cycle",
  "Labor_manu_lin_cycle",
  "FederalFundsRate_lin_cycle",
  "StockMarketIndex_log_cycle",
  "NAM"
)
```

```{r var_medium_lag}
VAR_medium_lag <- VARselect(
  VAR_data %>% select(!!!chosen_variables_eight),
  lag.max = 24
)
```

```{r VAR_medium}
VAR_medium <- VAR(
  VAR_data %>% select(!!!chosen_variables_eight),
  p = 12
)
```

```{r irf_medium_production, warning = FALSE}
irf_medium_production <- irf(
  VAR_medium,
  impulse = c("NAM", "FederalFundsRate_lin_cycle"),
  response = "Production_NAICS_log_cycle",
  n.ahead = 60,
  runs = 100,
  ci = 0.86
)
```

```{r irf_medium_production_matrix}
irf_medium_production_matrix <- tibble(
  Months = 0:60,
  `Response to a non-asset-market uncertainty shock` = as.vector(
    irf_medium_production[["irf"]][["NAM"]]
  ),
  NAM_lower = as.vector(irf_medium_production[["Lower"]][["NAM"]]),
  NAM_upper = as.vector(irf_medium_production[["Upper"]][["NAM"]]),
  `Response to a federal funds rate shock` = -as.vector(
    irf_medium_production[["irf"]][["FederalFundsRate_lin_cycle"]]
  )
) %>%
  gather(
    `Response to a non-asset-market uncertainty shock`,
    `Response to a federal funds rate shock`,
    key = "Imp",
    value = "Res"
  )
```

(ref:production-medium) **Decline of Production Under Uncertainty in the 8-Variable VAR**: The figure shows the reaction of industrial production in manufacturing to an unexpected increment of non-asset-market uncertainty and to an unexpected increment of the federal funds rate (model with 12 fixed lags following Leeb \& Pötscher [-@leebpots:2005;-@leebpots:2006], as explained in [Lag order]), based on 1000 replications. The axis is in percentage. The estimation period runs from January 1985 to July 2017. Confidence bands (86 \%) are calculated using bootstrapping techniques as explained in @efrotibs:1993.

```{r production-medium, fig.cap = "(ref:production-medium)", fig.scap = "Decline of Production Under Uncertainty in the 8-Variable VAR"}
irf_medium_production_matrix %>%
  ggplot(aes(Months, Res)) +
    geom_hline(aes(yintercept = 0), size = 0.125) +
    geom_ribbon(
      data = irf_medium_production_matrix %>% 
        filter(Imp == "Response to a non-asset-market uncertainty shock"),
      aes(ymin = NAM_lower, ymax = NAM_upper),
      fill = "steelblue",
      alpha = 0.125
    ) +
    geom_line(aes(colour = Imp, linetype = Imp)) +
    scale_x_continuous(breaks = seq(0, 60, by = 5)) +
    scale_y_continuous(breaks = seq(0.55, -0.95, by = -0.15)) +
    scale_color_manual(values = c(inferno(1), "steelblue")) +
    scale_linetype_manual(values = c("dotdash", "dashed")) +
    labs(
      caption = "Source: Own calculations",
      x = "Months after the shock",
      y = "% impact on production",
      colour = "",
      linetype = ""
    ) +
    theme(legend.position = "bottom")
```

```{r irf_medium_employment, warning = FALSE}
irf_medium_employment <- irf(
  VAR_medium,
  impulse = c("NAM", "FederalFundsRate_lin_cycle"),
  response = "Employment_manu_lin_cycle",
  n.ahead = 60,
  runs = 100,
  ci = 0.86
)
```

```{r irf_medium_employment_matrix}
irf_medium_employment_matrix <- tibble(
  Months = 0:60,
  `Response to a non-asset-market uncertainty shock` = as.vector(
    irf_medium_employment[["irf"]][["NAM"]]
  ),
  NAM_lower = as.vector(irf_medium_employment[["Lower"]][["NAM"]]),
  NAM_upper = as.vector(irf_medium_employment[["Upper"]][["NAM"]]),
  `Response to a federal funds rate shock` = -as.vector(
    irf_medium_employment[["irf"]][["FederalFundsRate_lin_cycle"]]
  )
) %>%
  gather(
    `Response to a non-asset-market uncertainty shock`,
    `Response to a federal funds rate shock`,
    key = "Imp",
    value = "Res"
  )
```

(ref:employment-medium) **Decline of Employment Under Uncertainty in the 8-Variable VAR**: The figure shows the reaction of employment in manufacturing to an unexpected increment of non-asset-market uncertainty and to an unexpected increment of the federal funds rate (model with 12 fixed lags following Leeb \& Pötscher [-@leebpots:2005;-@leebpots:2006], as explained in [Lag order]), based on 1000 replications. The axis is in percentage. The estimation period runs from January 1985 to July 2017. Confidence bands (86 \%) are calculated using bootstrapping techniques as explained in @efrotibs:1993.

```{r employment-medium, fig.cap = "(ref:employment-medium)", fig.scap = "Decline of Employment Under Uncertainty in the 8-Variable VAR"}
irf_medium_employment_matrix %>%
  ggplot(aes(Months, Res)) +
    geom_hline(aes(yintercept = 0), size = 0.125) +
    geom_ribbon(
      data = irf_medium_employment_matrix %>%
        filter(Imp == "Response to a non-asset-market uncertainty shock"),
      aes(ymin = NAM_lower, ymax = NAM_upper),
      fill = "steelblue",
      alpha = 0.125
    ) +
    geom_line(aes(colour = Imp, linetype = Imp)) +
    scale_x_continuous(breaks = seq(0, 60, by = 5)) +
    scale_y_continuous(breaks = seq(60, -90, by = -15)) +
    scale_color_manual(values = c(inferno(1), "steelblue")) +
    scale_linetype_manual(values = c("dotdash", "dashed")) +
    labs(
      caption = "Source: Own calculations",
      x = "Months after the shock",
      y = "Impact on employment",
      colour = "",
      linetype = ""
    ) +
    theme(legend.position = "bottom")
```

```{r VAR_trivariate_lag}
VAR_trivariate_lag <- VARselect(
  VAR_data %>% select(
    Production_NAICS_log_cycle,
    Employment_manu_lin_cycle,
    NAM
  ),
  lag.max = 24
)
```

```{r VAR_trivariate}
VAR_trivariate <- VAR(
  VAR_data %>% select(
    Production_NAICS_log_cycle,
    Employment_manu_lin_cycle,
    NAM
  ),
  p = 12
)
```

```{r irf_trivariate, warning = FALSE}
irf_trivariate <- irf(
  VAR_trivariate,
  impulse = "NAM",
  response = "Production_NAICS_log_cycle",
  n.ahead = 60,
  runs = 100,
  ci = 0.86
)
```

```{r VAR_quadvariate}
VAR_quadvariate <- VAR(
  VAR_data %>% select(
    Production_NAICS_log_cycle,
    Employment_manu_lin_cycle,
    StockMarketIndex_log_cycle,
    NAM
  ),
  p = 12
)
```

```{r irf_quadvariate, warning = FALSE}
irf_quadvariate <- irf(
  VAR_quadvariate,
  impulse = "NAM",
  response = "Production_NAICS_log_cycle",
  n.ahead = 60,
  runs = 100,
  ci = 0.86
)
```

```{r VAR_quadvariate_reverse}
VAR_quadvariate_reverse <- VAR(
  VAR_data %>% select(
    NAM,
    StockMarketIndex_log_cycle,
    Employment_manu_lin_cycle,
    Production_NAICS_log_cycle
  ),
  p = 12
)
```

```{r irf_quadvariate_reverse, warning = FALSE}
irf_quadvariate_reverse <- irf(
  VAR_quadvariate_reverse,
  impulse = "NAM",
  response = "Production_NAICS_log_cycle",
  n.ahead = 60,
  runs = 100,
  ci = 0.86
)
```

(ref:robustness) **VAR Model is Robust to Different Variable Sets and Ordering**: The figure shows the reaction of production---both production and employment are for the manufacturing sector---to an unexpected increment of non-asset-market uncertainty. The axis is in percentage. The estimation period runs from January 1985 to July 2017. The models are defined as: trivariate (production, employment and non-asset-market uncertainty shocks), Quadvariate (production, employment, stock-market and non-asset-market uncertainty shocks) and Quadvariate in reverse (non-asset-market uncertainty shocks, stock-market, employment and production).

```{r robustness, fig.cap = "(ref:robustness)", fig.scap = "VAR Model is Robust to Different Variable Sets and Ordering"}
tibble(
  Months = 0:60,
  Trivariate = irf_trivariate[["irf"]][["NAM"]],
  Quadvariate = irf_quadvariate[["irf"]][["NAM"]],
  `Quadvariate in reverse` = irf_quadvariate_reverse[["irf"]][["NAM"]]
) %>%
  gather(
    Trivariate, Quadvariate, `Quadvariate in reverse`,
    key = "VAR",
    value = "Shock"
  ) %>%
  ggplot(aes(Months, Shock)) +
    geom_hline(aes(yintercept = 0)) +
    geom_line(aes(colour = VAR, linetype = VAR)) +
    scale_x_continuous(breaks = seq(0, 60, by = 5)) +
    scale_y_continuous(breaks = seq(0, -1.50, by = -0.25)) +
    scale_color_viridis_d(option = "inferno") +
    labs(
      caption = "Source: Own calculations",
      x = "Months after the shock",
      y = "% impact on production",
      colour = "",
      linetype = ""
    ) +
    theme(legend.position = "bottom")
```
